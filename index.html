<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <title>ChromePortal | Pro Dashboard</title> 
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üåÄ</text></svg>">
    
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <style>
        :root {
            --bg-gradient: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            --card-bg: rgba(255, 255, 255, 0.95);
            --text-main: #2d3436;
            --accent: #0984e3;
            --danger: #d63031;
            --shadow: 0 8px 32px rgba(31, 38, 135, 0.15);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-gradient);
            background-attachment: fixed;
            margin: 0; min-height: 100vh;
            display: flex; flex-direction: column; align-items: center;
        }

        /* --- AUTH OVERLAY --- */
        #authOverlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg-gradient); z-index: 1000;
            display: flex; justify-content: center; align-items: center;
        }
        .auth-card {
            background: white; padding: 40px; border-radius: 20px;
            box-shadow: var(--shadow); width: 100%; max-width: 400px; text-align: center;
        }
        .auth-card input { width: 100%; margin-bottom: 15px; box-sizing: border-box; }

        /* --- MAIN UI --- */
        .container { 
            width: 100%; max-width: 900px; padding: 20px; flex: 1; display: none; 
        }
        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        
        .nav-buttons button {
            background: none; border: 1px solid var(--accent); color: var(--accent);
            padding: 8px 15px; border-radius: 5px; cursor: pointer; margin-left: 10px;
        }

        .input-panel {
            background: var(--card-bg); padding: 25px; border-radius: 16px;
            display: grid; grid-template-columns: 1fr 1fr auto; gap: 15px; 
            margin-bottom: 30px; box-shadow: var(--shadow);
        }

        input { padding: 12px; border-radius: 8px; border: 1px solid #ddd; outline: none; transition: 0.3s; }
        input:focus { border-color: var(--accent); box-shadow: 0 0 5px rgba(9,132,227,0.2); }

        .add-btn {
            background: var(--accent); color: white; border: none; padding: 12px 25px;
            border-radius: 8px; cursor: pointer; font-weight: bold;
        }

        .link-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 20px; }
        .link-card {
            background: white; border-radius: 15px; padding: 20px;
            display: flex; flex-direction: column; align-items: center;
            position: relative; transition: 0.3s; box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            cursor: pointer;
        }
        .link-card:hover { transform: translateY(-5px); box-shadow: var(--shadow); }
        .link-card img { width: 40px; height: 40px; margin-bottom: 12px; border-radius: 8px; }
        .link-card a { color: var(--text-main); text-decoration: none; font-weight: 600; font-size: 0.95rem; }

        .delete-btn {
            position: absolute; top: 10px; right: 10px; background: var(--danger);
            color: white; border: none; width: 24px; height: 24px; border-radius: 50%;
            cursor: pointer; display: none; font-size: 12px;
        }
        .link-card:hover .delete-btn { display: block; }

        /* --- SETTINGS MODAL --- */
        #settingsModal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 2000; justify-content: center; align-items: center;
        }
        .settings-content {
            background: white; padding: 30px; border-radius: 15px; width: 90%; max-width: 400px;
        }
        .danger-zone { border-top: 2px solid #eee; margin-top: 20px; padding-top: 20px; }
        .del-acc-btn { width: 100%; background: var(--danger); color: white; border: none; padding: 12px; border-radius: 8px; font-weight: bold; cursor: pointer; }

        .site-footer { padding: 20px; color: #636e72; font-size: 0.85rem; }
    </style>
</head>
<body>

<div id="authOverlay">
    <div class="auth-card">
        <h2 id="authTitle">Login to ChromePortal</h2>
        <input type="email" id="authEmail" placeholder="Email Address">
        <input type="password" id="authPass" placeholder="Password">
        <button class="add-btn" style="width:100%" onclick="handleAuth()">Continue</button>
        <p style="font-size: 0.8rem; margin-top: 15px; cursor: pointer; color: var(--accent);" onclick="toggleAuthMode()" id="authToggle">
            Don't have an account? Sign Up
        </p>
    </div>
</div>

<div id="settingsModal">
    <div class="settings-content">
        <h3>User Settings</h3>
        <p id="userEmailDisplay" style="color: #636e72;"></p>
        <button onclick="closeSettings()" style="width:100%; margin-bottom: 10px; padding: 10px;">Close</button>
        
        <div class="danger-zone">
            <h4>Danger Zone</h4>
            <p style="font-size: 0.8rem; color: #d63031;">This action is permanent. All your shortcuts will be lost.</p>
            <button class="del-acc-btn" onclick="deleteAccount()">DELETE ACCOUNT</button>
        </div>
    </div>
</div>

<div class="container" id="mainApp">
    <header>
        <h1>ChromePortal</h1>
        <div class="nav-buttons">
            <button onclick="openSettings()">‚öôÔ∏è Settings</button>
            <button onclick="logout()">Logout</button>
        </div>
    </header>

    <div class="input-panel">
        <input type="text" id="siteName" placeholder="Site Name">
        <input type="text" id="siteUrl" placeholder="URL (google.com)">
        <button class="add-btn" onclick="addLink()">Add Shortcut</button>
    </div>

    <div class="search-container">
        <input type="text" id="searchBar" placeholder="Search your portal..." oninput="filterLinks()" style="width:100%">
    </div>

    <div id="linkGrid" class="link-grid"></div>

    <footer class="site-footer">
        Portal Session: <span id="sessionDate"></span>
    </footer>
</div>

<script>
    // --- 1. FIREBASE CONFIGURATION ---
    const firebaseConfig = {
       apiKey: "AIzaSyAoj4yHcaRW4wdOPA7SrZhGQZqAobHDdB0",
  authDomain: "toolbox-hub-98c03.firebaseapp.com",
  projectId: "toolbox-hub-98c03",
  storageBucket: "toolbox-hub-98c03.firebasestorage.app",
  messagingSenderId: "321020105472",
  appId: "1:321020105472:web:698ba3bf9dfe75add859e5"
};
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    let isSignUpMode = false;
    let currentUser = null;
    let userLinks = [];

    // --- 2. AUTHENTICATION LOGIC ---
    function toggleAuthMode() {
        isSignUpMode = !isSignUpMode;
        document.getElementById('authTitle').innerText = isSignUpMode ? "Create Account" : "Login to ChromePortal";
        document.getElementById('authToggle').innerText = isSignUpMode ? "Already have an account? Login" : "Don't have an account? Sign Up";
    }

    async function handleAuth() {
        const email = document.getElementById('authEmail').value;
        const pass = document.getElementById('authPass').value;
        
        try {
            if (isSignUpMode) {
                await auth.createUserWithEmailAndPassword(email, pass);
            } else {
                await auth.signInWithEmailAndPassword(email, pass);
            }
        } catch (error) {
            alert(error.message);
        }
    }

    auth.onAuthStateChanged(user => {
        if (user) {
            currentUser = user;
            document.getElementById('authOverlay').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            document.getElementById('userEmailDisplay').innerText = user.email;
            document.getElementById('sessionDate').innerText = new Date().toLocaleDateString();
            loadLinks();
        } else {
            document.getElementById('authOverlay').style.display = 'flex';
            document.getElementById('mainApp').style.display = 'none';
        }
    });

    function logout() { auth.signOut(); }

    async function deleteAccount() {
        if (confirm("Are you absolutely sure? This cannot be undone.")) {
            try {
                // Delete user data from Firestore first
                await db.collection("users").doc(currentUser.uid).delete();
                // Delete auth account
                await currentUser.delete();
                alert("Account deleted.");
            } catch (error) {
                alert("Please logout and login again to verify your identity before deleting account.");
            }
        }
    }

    // --- 3. DATABASE LOGIC ---
    async function loadLinks() {
        db.collection("users").doc(currentUser.uid).onSnapshot(doc => {
            if (doc.exists) {
                userLinks = doc.data().links || [];
                renderLinks(userLinks);
            }
        });
    }

    async function addLink() {
        const name = document.getElementById('siteName').value.trim();
        let url = document.getElementById('siteUrl').value.trim();
        if (!name || !url) return;
        if (!url.startsWith('http')) url = 'https://' + url;

        const newLink = { name, url, id: Date.now() };
        userLinks.push(newLink);
        
        await db.collection("users").doc(currentUser.uid).set({ links: userLinks });
        document.getElementById('siteName').value = '';
        document.getElementById('siteUrl').value = '';
    }

    async function deleteLink(id) {
        userLinks = userLinks.filter(l => l.id !== id);
        await db.collection("users").doc(currentUser.uid).update({ links: userLinks });
    }

    // --- 4. UI RENDERING ---
    function renderLinks(data) {
        const grid = document.getElementById('linkGrid');
        grid.innerHTML = '';
        data.forEach(link => {
            const card = document.createElement('div');
            card.className = 'link-card';
            card.onclick = () => window.open(link.url, '_blank');

            const delBtn = document.createElement('button');
            delBtn.className = 'delete-btn';
            delBtn.innerHTML = '‚úï';
            delBtn.onclick = (e) => { e.stopPropagation(); deleteLink(link.id); };

            const img = document.createElement('img');
            img.src = `https://www.google.com/s2/favicons?sz=64&domain=${link.url}`;
            img.onerror = () => img.src = 'logo.png';

            const a = document.createElement('a');
            a.textContent = link.name;

            card.append(delBtn, img, a);
            grid.appendChild(card);
        });
    }

    function filterLinks() {
        const term = document.getElementById('searchBar').value.toLowerCase();
        const filtered = userLinks.filter(l => l.name.toLowerCase().includes(term));
        renderLinks(filtered);
    }

    function openSettings() { document.getElementById('settingsModal').style.display = 'flex'; }
    function closeSettings() { document.getElementById('settingsModal').style.display = 'none'; }
</script>
</body>
</html>
